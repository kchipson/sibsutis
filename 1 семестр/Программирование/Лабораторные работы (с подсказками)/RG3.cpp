//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//???????????????                                      ????????????????
//?????              setfillstyle(4, 9); задний цвет?             ?????
//???????????????                                      ????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
//?????????????????????????????????????????????????????????????????????
#include <stdlib.h>
#include <math.h>
#include <iostream>
using namespace std;
#include <conio.h>
#include <graphics.h>
#include <ctime>
#include <Windows.h>

#define CHAG 20
#define r 1
#define dx 20

void SetColor(int text, int bg){
    HANDLE hStdOut = GetStdHandle(STD_OUTPUT_HANDLE);// ВЕЛИКИЙ И МОГУЧИЙ
    SetConsoleTextAttribute(hStdOut, (WORD)((bg << 4) | text));// ИНТЕРНЕТ
}

void ship(int x, int y,int zv=1){
	//cout<<"x= "<<x<<"\ny=   "<<y<<"\n*******************************************\n";
	int color,color1;
	if (zv!=1) color1=color=9; //Черный
	else color=1; //Синий

	setcolor (color);
	moveto ( x, y ); // курсор в точку (x1,y1)
	//circle ( x, y,5*r);  // рисуем окружность
	lineto ( x, y+r*90); // мачта
	lineto ( x-75*r, y+r*90); // от мачты влево
	lineto ( x-75*r, y+r*125);  // от влево вниз
	lineto ( x+52*r, y+r*125);  // от вниз вправо
	lineto ( x+107*r, y+r*90);// от вправо угол
	lineto ( x, y+r*90);// от угол к мачте
	// ФЛАГ
	lineto ( x, y+r*70);  // от мачты к нач точке
	lineto ( x-52*r, y+r*70); // от нач точки к лев низ
	lineto ( x-52*r, y+r*20); // от лев низ к лев верх
	lineto ( x+72*r, y+r*20); // от лев верх к крайний прав верх
	lineto ( x+52*r, y+r*20);// от крайний прав верх к прав верх
	lineto ( x+52*r, y+r*70); // от прав верх к прав низ
	lineto ( x, y+r*70);// от прав низ к мачте
	if (zv==1) color1=5; //Коричневый
	
	setfillstyle(1, color1 ); 
	//setfillstyle ( 1, color1 );
	//setfillstyle ( 4, color1 );
	//circle ( x, y+r*70,5*r);  // рисуем окружность
	floodfill ( x, y+r*90+1,color);// заливка дна
		
	if (zv==1) color1=15; //Белый
	setfillstyle (1, color1 );
	floodfill ( x-1, y+r*70-1,color);	 // заливка лев паруса
	floodfill ( x+1, y+r*70-1,color);	 // заливка прав паруса
	
}


void one(){ 
	
	//5.	Движение с изменяющимся углом (dx - const, dy - variable) с отражением от границ экрана
	int d=GetSystemMetrics(SM_CXSCREEN),ch=GetSystemMetrics(SM_CYSCREEN)-60,dy,koefx,koefy;
	//ch=d=500;
	initwindow (d, ch); // открыть окно для графики
	setfillstyle(1, 9); // сплошная заливка(для экрана)
	bar (0, 0, d, ch); // заливаем фон 
	setfillstyle(1, 0);
	int x=d/2,y=ch/2,k;
	bool f=1;
	
	dy=rand() % ch;

	koefy=(dy/((dy-y)/CHAG));
	koefx= (dx/(dx/CHAG));
	ship(x,y);
	
	
	while (f){
		//cout<<"x=  "<<x<<"\ny=  "<<y<<"\ndy=  "<<dy<<"\n******************************\n";
		delay(100);
	    if ( _kbhit() ) // если нажата клавиша…
	       if ( _getch() == 27 ){  // если нажата Esc
	       		closegraph();
				f=0;	
	  		}	  		
	  	ship(x,y,0);
		x= x+koefx;
		y= y+koefy;
	
	
	if(y+r*125>ch) { //низ
		y=ch-r*138;
		ship(x,y);
		koefy=-koefy;
	}
	
	else if(y<0) { //верх
		y=0;
		ship(x,y);
		koefy=-koefy;
	}
	
	else  if(x-75*r<0) {
		x=75*r;
		ship(x,y);
		koefx=-koefx;
			
	}

	else if(x+107*r>d) {
		x=d-115*r;
		ship(x,y);
		koefx=-koefx;			
	}
	
	else ship(x,y);
	
	}

} 



void two(){ 	
	int d=GetSystemMetrics(SM_CXSCREEN),ch=GetSystemMetrics(SM_CYSCREEN)-60,dy;
	//ch=d=500;
	initwindow (d, ch); // открыть окно для графики
	setfillstyle(1, 9); // сплошная заливка(для экрана)
	bar (0, 0, d, ch); // заливаем фон 
	setfillstyle(1, 0);
	//3.	Управление клавишами с цифрами 4, 6, 8, 2.	
	int x=d/2,y=ch/2,k;
	bool f=1;
	ship(x,y);
	
	while (f){
		do{
			dy=rand() % ch;
		}while(dy==y);
		
		k=_getch();// ждем нажатия клавиши
		ship(x,y,0);
        switch(k){
			case 52:// ЧЕТЫРЕ
				{
		            x-=CHAG;
		            if(x-75*r<0) x=75*r;
		            ship(x,y);	            
					break;
				}
			
			case 54:// 6
	            {
	            
	            x+=CHAG;
	            if(x+107*r>d) x=d-115*r;
	            ship(x,y);
				break;
				}
			case 50:// 2
	            {
	            ship(x,y,0);
	            y+=CHAG;
	            if(y+r*125>ch) y=ch-r*138;
	            ship(x,y);
				break;
				}
			case 56:// 8
	            {
	            ship(x,y,0);
	            y-=CHAG;
	            if(y<0) y=0;
	            ship(x,y);
				break;
				}
			case 27:
	            {
	            closegraph();
				f=0;	
				break;		
				}
			default:
				{
					ship(x,y);
				}

		}
		
	}
} 

void three(){ 
	exit(0);

} 

void menu(int choice){
    	system("CLS");
    	if(choice==1)
			SetColor(2, 0);
		cout<<"\n     ************************************************\n";
		cout<<"     *                                              *\n";
		cout<<"     *         1. Свободное движение объекта        *\n";
		cout<<"     *                                              *\n";
		if(choice==2)
			SetColor(2, 0);
		cout<<"     ************************************************\n";
		if(choice==1)
			SetColor(7, 0);
		cout<<"     *                                              *\n";
		cout<<"     *   2. Движение объекта с помощью клавиатуры   *\n";
		cout<<"     *                                              *\n";
		if(choice==3)
			SetColor(2, 0);
		cout<<"     ************************************************\n";
		if(choice==2)
			SetColor(7, 0);
		cout<<"     *                                              *\n";
		cout<<"     *            3. Выход из программы             *\n";
		cout<<"     *                                              *\n";
		cout<<"     ************************************************\n";
		SetColor(7, 0);
		cout<<" ";
	
	}

main(){ 
	srand(time(NULL));
    int choice=1 ,code ,ch,flag=0;
	menu(choice); 
    while (1){
        switch(_getch()){
			case 224:
	            {
				switch(_getch()){
		                    case 72: {choice--;break;}
		                    case 80: choice++;
	                	}        	
				//cout<<choice;
				if(choice==4) choice=1;
				if(choice==0) choice=3;
				menu(choice);
				break;
				}
			case 13:
	            {	
	            	if (flag){
						closegraph(); // закрываем графическое окно
					}
					flag=1;	            	
					if(choice==1) 
					 {
					one();
					flag=0;	
					}
					else if(choice==2)  {
					two(); 
					flag=0;	
					}
					else if(choice==3) three(); 
					
					
				}

		}
		
	} 
}


//#include <iostream>
//#include <Windows.h>
//using namespace std;
// 
//void SetColor(int text, int bg){
//    HANDLE hStdOut = GetStdHandle(STD_OUTPUT_HANDLE);
//    SetConsoleTextAttribute(hStdOut, (WORD)((bg << 4) | text));
//}
// 
//int main(){
//    SetColor(14, 0);
//    cout << "test ";
//    SetColor(9, 0);
//    cout << "test2\n";
//    SetColor(7, 0);
// 
//    return 0;
//}
