"use strict";if(void 0===WPFormsChallenge)var WPFormsChallenge={};WPFormsChallenge.core=window.WPFormsChallenge.core||function(e,t,l){var n={initialSecondsLeft:60*WPFormsChallenge.admin.l10n.minutes_left,loadId:function(){return localStorage.getItem("wpformsChallengeTimerId")},saveId:function(e){localStorage.setItem("wpformsChallengeTimerId",e)},run:function(e){if(5!==o.loadStep()){var t=setInterval(function(){o.updateTimerUI(e),--e<0&&(n.saveSecondsLeft(0),clearInterval(t))},1e3);return n.saveId(t),t}},pause:function(){var e,t;0!==n.getSecondsLeft()&&5!==o.loadStep()&&(e=n.loadId(),clearInterval(e),(t=l("#wpforms-challenge-timer").data("seconds-left"))&&n.saveSecondsLeft(t))},resume:function(){var e,t=n.getSecondsLeft();0!==t&&5!==o.loadStep()&&((e=n.loadId())&&clearInterval(e),n.run(t))},clear:function(){localStorage.removeItem("wpformsChallengeSecondsLeft"),localStorage.removeItem("wpformsChallengeTimerId"),localStorage.removeItem("wpformsChallengeTimerStatus"),l("#wpforms-challenge-timer").removeData("seconds-left")},getSecondsLeft:function(){var e=localStorage.getItem("wpformsChallengeSecondsLeft");return e=parseInt(e,10)||0},getSecondsSpent:function(e){return e=e||n.getSecondsLeft(),n.initialSecondsLeft-e},saveSecondsLeft:function(e){localStorage.setItem("wpformsChallengeSecondsLeft",e)},getMinutesFormatted:function(e){return e=e||n.getSecondsLeft(),Math.floor(e/60)},getSecondsFormatted:function(e){return(e=e||n.getSecondsLeft())%60},getFormatted:function(e){e=e||n.getSecondsLeft();var t=n.getMinutesFormatted(e),o=n.getSecondsFormatted(e);return t+(9<o?":":":0")+o}},o={timer:n,init:function(){l(e).ready(o.ready),l(t).load(o.load)},ready:function(){o.setup(),o.events()},load:function(){o.timer.run(o.timer.getSecondsLeft())},setup:function(){var e,t=o.timer.loadId();t&&(clearInterval(t),e=o.timer.getSecondsLeft()),t||0!==o.loadStep()||(e=o.timer.initialSecondsLeft),o.refreshStep(),o.updateListUI(),o.updateTimerUI(e)},events:function(){l([t,e]).blur(function(){o.timer.pause()}),l([t,e]).focus(function(){o.timer.resume()}),l(".wpforms-challenge-cancel").click(function(){o.timer.pause(),o.cancelChallenge()})},loadStep:function(){var e=localStorage.getItem("wpformsChallengeStep");return e=parseInt(e,10)||0},saveStep:function(e){return localStorage.setItem("wpformsChallengeStep",e),WPFormsChallenge.admin.saveChallengeOption({step:e})},refreshStep:function(){var e=l(".wpforms-challenge").data("wpforms-challenge-saved-step");e=parseInt(e,10)||0,o.loadStep()!==e&&o.saveStep(e)},stepCompleted:function(e){return o.updateListUI(e),o.updateTooltipUI(e),o.saveStep(e)},initTooltips:function(o,e,t){var n=l('<span class="wpforms-challenge-dot wpforms-challenge-dot-step'+o+'" data-wpforms-challenge-step="'+o+'">&nbsp;</span>'),a={content:l("#tooltip-content"+o),trigger:null,interactive:!0,animationDuration:0,delay:0,theme:["tooltipster-default","wpforms-challenge-tooltip"],functionReady:function(e,t){l(t.tooltip).addClass("wpforms-challenge-tooltip-step"+o),e.reposition()}};"object"==typeof t&&null!==t&&l.extend(a,t),n.insertAfter(e).tooltipster(a)},updateTooltipUI:function(e){var a;e=e||o.loadStep(),a=e+1,l(".wpforms-challenge-dot").each(function(e,t){var o=l(t),n=o.data("wpforms-challenge-step");n<a&&o.addClass("wpforms-challenge-dot-completed"),a<n&&o.addClass("wpforms-challenge-dot-next"),n===a&&o.removeClass("wpforms-challenge-dot-completed wpforms-challenge-dot-next"),setTimeout(function(){o.is(":visible")&&n===a?o.tooltipster("open"):o.tooltipster("close")},0)})},updateListUI:function(e){e=e||o.loadStep(),l(".wpforms-challenge-list li:lt("+e+")").addClass("wpforms-challenge-item-completed"),l(".wpforms-challenge-list li:eq("+e+")").addClass("wpforms-challenge-item-current"),l(".wpforms-challenge-bar div").css("width",20*e+"%")},updateTimerUI:function(e){e&&!isNaN(e)&&"0"!==e||(e=0),o.timer.saveSecondsLeft(e),l("#wpforms-challenge-timer").text(o.timer.getFormatted(e)).data("seconds-left",e)},removeChallengeUI:function(){l(".wpforms-challenge-dot").remove(),l(".wpforms-challenge").remove()},clearLocalStorage:function(){localStorage.removeItem("wpformsChallengeStep"),o.timer.clear()},cancelChallenge:function(){var e={status:"canceled",seconds_spent:o.timer.getSecondsSpent(),seconds_left:o.timer.getSecondsLeft(),feedback_sent:!1};o.removeChallengeUI(),o.clearLocalStorage(),"undefined"!=typeof WPFormsBuilder?WPFormsChallenge.admin.saveChallengeOption(e).done(WPFormsBuilder.formSave).done(location.reload.bind(location)):WPFormsChallenge.admin.saveChallengeOption(e).done(o.triggerPageSave)},isGutenberg:function(){return"undefined"!=typeof wp&&wp.hasOwnProperty("blocks")},triggerPageSave:function(){o.isGutenberg()?o.gutenbergPageSave():l("#post #publish").trigger("click")},gutenbergPageSave:function(){var e={targetNode:l(".block-editor .edit-post-layout")[0],config:{childList:!0},callback:function(e,t){for(var o in e)if("childList"===e[o].type){var n=l(".block-editor .editor-post-publish-button");0<n.length&&(n.trigger("click"),t.disconnect())}}};e.observer=new MutationObserver(e.callback),e.observer.observe(e.targetNode,e.config),l(".block-editor .edit-post-toggle-publish-panel__button").trigger("click")}};return o}(document,window,jQuery),WPFormsChallenge.core.init();